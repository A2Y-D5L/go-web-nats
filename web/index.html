<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Launch Studio App Journey</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <div class="ambient-layer" aria-hidden="true"></div>

    <div class="app-shell">
      <main class="app-main" aria-label="App portal">
        <section id="landingPanel" class="panel landing-panel" aria-label="Apps landing">
          <header class="panel-head landing-head">
            <div>
              <h1>Your apps</h1>
              <p class="panel-copy">Choose an app to open its dedicated workspace.</p>
            </div>
            <div class="landing-actions">
              <button id="openCreateModalBtn" type="button" class="btn btn-primary">Create app</button>
              <button id="refreshBtn" type="button" class="btn btn-subtle">Refresh</button>
            </div>
          </header>

          <div class="filter-grid landing-filter-grid">
            <label class="field compact" for="projectSearch">
              <span>Search apps (/)</span>
              <input id="projectSearch" placeholder="Search by name, id, status, or message" />
            </label>
            <label class="field compact" for="phaseFilter">
              <span>Filter by state</span>
              <select id="phaseFilter">
                <option value="all">All states</option>
                <option value="Ready">Ready</option>
                <option value="Reconciling">In progress</option>
                <option value="Deleting">Deleting</option>
                <option value="Error">Needs attention</option>
              </select>
            </label>
            <label class="field compact" for="projectSort">
              <span>Sort apps</span>
              <select id="projectSort">
                <option value="updated_desc">Recently updated</option>
                <option value="name_asc">Name A-Z</option>
                <option value="created_asc">Oldest first</option>
              </select>
            </label>
          </div>

          <p id="projectStats" class="helper-text">0 visible</p>
          <div id="projects" class="project-list landing-project-list" role="listbox" aria-label="Apps"></div>
        </section>

        <section id="workspaceShell" class="workspace-shell is-hidden" aria-label="Selected app workspace">
          <article class="panel workspace-header-panel">
            <div class="panel-head">
              <div>
                <p class="workspace-kicker">App workspace</p>
                <h2 id="workspaceHeading">Selected app</h2>
              </div>
              <div class="selected-actions">
                <button id="closeWorkspaceBtn" type="button" class="btn btn-subtle">Back to apps</button>
                <button id="openUpdateModalBtn" type="button" class="btn btn-subtle">Edit app setup</button>
                <button id="openDeleteModalBtn" type="button" class="btn btn-danger">Delete app</button>
              </div>
            </div>

            <div id="appStatus" class="status-banner" role="status" aria-live="polite"></div>
            <div id="selected" class="project-summary muted">Select an app to view its delivery journey.</div>
          </article>

          <section class="system-strip system-strip-compact" aria-label="Portfolio summary">
            <article class="metric-card">
              <p class="metric-label">Apps in portfolio</p>
              <p id="systemProjectCount" class="metric-value">0</p>
              <p id="systemReadyCount" class="metric-meta">0 delivery-ready</p>
            </article>
            <article class="metric-card">
              <p class="metric-label">Runtime endpoint</p>
              <p id="healthLabel" class="metric-value">Loading</p>
              <p id="healthMeta" class="metric-meta">Loading system capability state</p>
            </article>
            <article class="metric-card">
              <p class="metric-label">Realtime transport</p>
              <p id="systemActiveOp" class="metric-value">Loading</p>
              <p id="systemActiveOpMeta" class="metric-meta">Checking SSE capability</p>
            </article>
            <article class="metric-card">
              <p class="metric-label">Builder mode</p>
              <p id="systemBuilderMode" class="metric-value">Loading</p>
              <p id="systemBuilderMeta" class="metric-meta">Reading effective mode</p>
            </article>
          </section>

          <nav class="focus-nav" aria-label="Workspace views" role="tablist">
            <button
              id="focusTabDelivery"
              type="button"
              class="focus-tab active"
              role="tab"
              aria-controls="focusPanelDelivery"
              aria-selected="true"
              data-workspace-tab="delivery"
            >
              Delivery
            </button>
            <button
              id="focusTabEnvironments"
              type="button"
              class="focus-tab"
              role="tab"
              aria-controls="focusPanelEnvironments"
              aria-selected="false"
              data-workspace-tab="environments"
            >
              Environments
            </button>
            <button
              id="focusTabActivity"
              type="button"
              class="focus-tab"
              role="tab"
              aria-controls="focusPanelActivity"
              aria-selected="false"
              data-workspace-tab="activity"
            >
              Activity
            </button>
          </nav>

          <section
            id="focusPanelDelivery"
            class="focus-panel active"
            role="tabpanel"
            aria-labelledby="focusTabDelivery"
            data-workspace-panel="delivery"
          >
            <article class="panel journey-panel">
              <div class="panel-head">
                <div>
                  <h2>Journey progress</h2>
                  <p id="journeyStatusLine" class="panel-copy">Select an app to load journey milestones.</p>
                </div>
                <button id="journeyNextActionBtn" type="button" class="btn btn-primary" disabled>
                  Run suggested step
                </button>
              </div>
              <div id="journeyNextAction" class="summary-card"></div>
              <div id="journeyMilestones" class="timeline"></div>
            </article>

            <section class="action-grid">
              <article class="panel ci-panel">
                <h3>1. Build from source changes</h3>
                <p class="panel-copy">
                  Start a build now using the default source webhook payload. Expand advanced options only when needed.
                </p>
                <form id="webhookForm" class="form-grid compact-form">
                  <button id="buildLatestBtn" type="submit" class="btn btn-primary field-full">Build latest source</button>
                  <p id="buildPanelStatus" class="panel-inline-status field-full">Ready to trigger a new build run.</p>
                  <details class="advanced-details field-full">
                    <summary>Advanced webhook payload</summary>
                    <p class="panel-copy">
                      Optional overrides for repository webhook metadata. Leave blank to use the default values.
                    </p>
                    <div class="advanced-grid">
                      <label class="field" for="webhookRepo">
                        <span>Repository</span>
                        <input id="webhookRepo" value="source" placeholder="source" />
                      </label>
                      <label class="field" for="webhookBranch">
                        <span>Branch</span>
                        <input id="webhookBranch" value="main" placeholder="main" />
                      </label>
                      <label class="field" for="webhookRef">
                        <span>Git ref</span>
                        <input id="webhookRef" value="refs/heads/main" placeholder="refs/heads/main" />
                      </label>
                      <label class="field" for="webhookCommit">
                        <span>Commit (optional)</span>
                        <input id="webhookCommit" placeholder="abc123def456" />
                      </label>
                    </div>
                  </details>
                </form>
              </article>

              <article class="panel deploy-panel">
                <h3>2. Deliver to dev</h3>
                <p class="panel-copy">Ship the latest built image to your dev environment for validation.</p>
                <div id="deploySummary" class="summary-card"></div>
                <p id="deployGuardrail" class="guardrail-text"></p>
                <p id="deployPanelStatus" class="panel-inline-status">Dev delivery is waiting for your confirmation.</p>
                <button id="deployDevBtn" type="button" class="btn btn-primary">Deliver to dev</button>
              </article>

              <article class="panel promotion-panel">
                <h3>3. Move across environments</h3>
                <p class="panel-copy">Promote between non-production environments, then release to production.</p>
                <form id="promotionForm" class="form-grid compact-form" novalidate>
                  <label class="field" for="promotionFrom">
                    <span>From</span>
                    <select id="promotionFrom"></select>
                  </label>
                  <label class="field" for="promotionTo">
                    <span>To</span>
                    <select id="promotionTo"></select>
                  </label>
                  <div id="promotionDraftSummary" class="summary-card field-full"></div>
                  <p id="promotionGuardrail" class="guardrail-text field-full"></p>
                  <p id="promotionPanelStatus" class="panel-inline-status field-full">
                    Choose source and target environments to continue.
                  </p>
                  <button id="openPromotionModalBtn" type="submit" class="btn btn-primary field-full">Review move</button>
                </form>
              </article>
            </section>
          </section>

          <section
            id="focusPanelEnvironments"
            class="focus-panel"
            role="tabpanel"
            aria-labelledby="focusTabEnvironments"
            data-workspace-panel="environments"
            hidden
          >
            <article class="panel environment-panel">
              <div class="panel-head">
                <div>
                  <h2>Environment outcomes</h2>
                  <p class="panel-copy">See where each environment stands and which image it is currently using.</p>
                </div>
                <button id="loadArtifactsBtn" type="button" class="btn btn-subtle">Refresh outputs</button>
              </div>
              <div id="environmentMatrix" class="environment-grid"></div>
            </article>

            <article class="panel artifacts-panel">
              <div class="panel-head">
                <h2>Outputs and logs</h2>
                <p id="artifactStats" class="helper-text">Outputs not loaded</p>
              </div>
              <label class="field compact" for="artifactSearch">
                <span>Filter outputs</span>
                <input id="artifactSearch" placeholder="deploy/dev, promotions/dev-to-staging, releases/stage-to-prod, repos/..." />
              </label>
              <div id="buildkitSignal" class="buildkit-signal muted">Output insight unavailable until outputs are loaded.</div>
              <div id="artifactQuickLinks" class="quick-links"></div>
              <div id="artifacts" class="artifact-list"></div>
              <div class="preview-head">
                <p id="artifactPreviewMeta" class="helper-text">Preview unavailable</p>
                <button id="copyPreviewBtn" type="button" class="btn btn-subtle" disabled>Copy preview</button>
              </div>
              <pre id="artifactPreview" class="codeblock muted">Select an output to preview.</pre>
            </article>
          </section>

          <section
            id="focusPanelActivity"
            class="focus-panel"
            role="tabpanel"
            aria-labelledby="focusTabActivity"
            data-workspace-panel="activity"
            hidden
          >
            <article class="panel operations-panel">
              <div class="panel-head">
                <h2>Recent activity</h2>
                <p class="helper-text">Live progress for the selected app</p>
              </div>
              <p id="opTransportStatus" class="panel-inline-status">Realtime stream connects after an action starts.</p>
              <div id="opProgress"></div>
              <div id="opErrorSurface"></div>
              <div id="opTimeline" class="timeline"></div>
              <div class="history-wrap">
                <h3>Activity history</h3>
                <div id="opHistory" class="history-list"></div>
              </div>
              <div class="history-wrap">
                <div class="panel-head">
                  <h3>Release timeline</h3>
                  <div class="history-actions">
                    <label class="field compact" for="releaseTimelineEnvironment">
                      <span>Environment</span>
                      <select id="releaseTimelineEnvironment"></select>
                    </label>
                    <button id="refreshReleaseTimelineBtn" type="button" class="btn btn-subtle">Refresh timeline</button>
                    <button id="openRollbackModalBtn" type="button" class="btn btn-primary" disabled>Review rollback</button>
                  </div>
                </div>
                <div id="rollbackTargetSummary" class="summary-card">
                  Rollback target not selected. Choose a release entry to prepare rollback context.
                </div>
                <p id="releaseTimelineStatus" class="panel-inline-status">
                  Select an environment to load release timeline history.
                </p>
                <div id="releaseTimeline" class="timeline"></div>
              </div>
              <details id="opRawWrap" class="raw-details">
                <summary>Show raw activity payload</summary>
                <pre id="lastOp" class="codeblock"></pre>
              </details>
            </article>
          </section>
        </section>
      </main>
    </div>

    <div id="createModal" class="modal is-hidden" role="dialog" aria-modal="true" aria-labelledby="createModalTitle">
      <button class="modal-backdrop" data-modal-close="create" aria-label="Close create dialog"></button>
      <section class="modal-card" aria-label="Create project dialog">
        <header class="modal-header">
          <h2 id="createModalTitle">Create app</h2>
          <button id="createModalCloseBtn" type="button" class="btn btn-subtle">Close</button>
        </header>

        <form id="createForm" class="form-grid modal-form">
          <input id="createAPIVersion" type="hidden" value="platform.example.com/v2" />
          <input id="createKind" type="hidden" value="App" />

          <label class="field" for="createName"><span>App name</span><input id="createName" required placeholder="my-service" /></label>
          <label class="field" for="createRuntime">
            <span>Runtime profile</span>
            <select id="createRuntime" required></select>
          </label>
          <label class="field field-full" for="createCapabilities"><span>Capabilities</span><input id="createCapabilities" placeholder="http,metrics" /></label>

          <div class="field-full env-builder">
            <div class="env-builder-head">
              <div>
                <p class="env-builder-title">Environment setup</p>
                <p class="helper-text">Add each environment this app should move through.</p>
              </div>
              <div class="env-builder-actions">
                <button id="createCleanKeysBtn" type="button" class="btn btn-subtle">Clean var keys</button>
                <button id="createAddEnvBtn" type="button" class="btn btn-subtle">Add environment</button>
              </div>
            </div>
            <div id="createEnvList" class="env-list"></div>
          </div>

          <details class="advanced-details field-full">
            <summary>Advanced networking</summary>
            <div class="advanced-grid">
              <label class="field" for="createIngress">
                <span>Network ingress</span>
                <select id="createIngress">
                  <option value="internal">internal</option>
                  <option value="none">none</option>
                </select>
              </label>
              <label class="field" for="createEgress">
                <span>Network egress</span>
                <select id="createEgress">
                  <option value="internal">internal</option>
                  <option value="none">none</option>
                </select>
              </label>
            </div>
          </details>

          <div class="modal-actions field-full">
            <button id="createModalCancelBtn" type="button" class="btn btn-subtle">Cancel</button>
            <button type="submit" class="btn btn-primary">Create app</button>
          </div>
        </form>
      </section>
    </div>

    <div id="updateModal" class="modal is-hidden" role="dialog" aria-modal="true" aria-labelledby="updateModalTitle">
      <button class="modal-backdrop" data-modal-close="update" aria-label="Close update dialog"></button>
      <section class="modal-card" aria-label="Update project dialog">
        <header class="modal-header">
          <h2 id="updateModalTitle">Edit app setup</h2>
          <button id="updateModalCloseBtn" type="button" class="btn btn-subtle">Close</button>
        </header>

        <form id="updateForm" class="form-grid modal-form">
          <input id="updateAPIVersion" type="hidden" value="platform.example.com/v2" />
          <input id="updateKind" type="hidden" value="App" />

          <label class="field" for="updateName"><span>App name</span><input id="updateName" required /></label>
          <label class="field" for="updateRuntime">
            <span>Runtime profile</span>
            <select id="updateRuntime" required></select>
          </label>
          <label class="field field-full" for="updateCapabilities"><span>Capabilities</span><input id="updateCapabilities" /></label>

          <div class="field-full env-builder">
            <div class="env-builder-head">
              <div>
                <p class="env-builder-title">Environment setup</p>
                <p class="helper-text">Keep environments explicit so delivery transitions stay safe.</p>
              </div>
              <div class="env-builder-actions">
                <button id="updateCleanKeysBtn" type="button" class="btn btn-subtle">Clean var keys</button>
                <button id="updateAddEnvBtn" type="button" class="btn btn-subtle">Add environment</button>
              </div>
            </div>
            <div id="updateEnvList" class="env-list"></div>
          </div>

          <details class="advanced-details field-full">
            <summary>Advanced networking</summary>
            <div class="advanced-grid">
              <label class="field" for="updateIngress">
                <span>Network ingress</span>
                <select id="updateIngress">
                  <option value="internal">internal</option>
                  <option value="none">none</option>
                </select>
              </label>
              <label class="field" for="updateEgress">
                <span>Network egress</span>
                <select id="updateEgress">
                  <option value="internal">internal</option>
                  <option value="none">none</option>
                </select>
              </label>
            </div>
          </details>

          <div class="modal-actions field-full">
            <button id="updateModalCancelBtn" type="button" class="btn btn-subtle">Cancel</button>
            <button type="submit" class="btn btn-primary">Save changes</button>
          </div>
        </form>
      </section>
    </div>

    <div id="deleteModal" class="modal is-hidden" role="dialog" aria-modal="true" aria-labelledby="deleteModalTitle">
      <button class="modal-backdrop" data-modal-close="delete" aria-label="Close delete dialog"></button>
      <section class="modal-card modal-card-danger" aria-label="Delete project dialog">
        <header class="modal-header">
          <h2 id="deleteModalTitle">Delete app</h2>
          <button id="deleteModalCloseBtn" type="button" class="btn btn-subtle">Close</button>
        </header>

        <div class="delete-warning">
          <p class="delete-warning-title">This permanently deletes the app record and its local outputs.</p>
          <p id="deleteModalTarget" class="delete-target"></p>
        </div>

        <form id="deleteConfirmForm" class="form-grid modal-form">
          <label class="field field-full" for="deleteConfirmInput">
            <span>Type the app name to confirm</span>
            <input id="deleteConfirmInput" autocomplete="off" />
          </label>
          <p id="deleteConfirmHint" class="helper-text field-full"></p>
          <div class="modal-actions field-full">
            <button id="deleteModalCancelBtn" type="button" class="btn btn-subtle">Cancel</button>
            <button id="deleteConfirmBtn" type="submit" class="btn btn-danger" disabled>Delete app permanently</button>
          </div>
        </form>
      </section>
    </div>

    <div id="promotionModal" class="modal is-hidden" role="dialog" aria-modal="true" aria-labelledby="promotionModalTitle">
      <button class="modal-backdrop" data-modal-close="promotion" aria-label="Close transition dialog"></button>
      <section class="modal-card modal-card-warning" aria-label="Transition confirmation dialog">
        <header class="modal-header">
          <h2 id="promotionModalTitle">Confirm environment move</h2>
          <button id="promotionModalCloseBtn" type="button" class="btn btn-subtle">Close</button>
        </header>

        <div class="promotion-warning">
          <p class="promotion-warning-title">Review source, target, and image before continuing.</p>
          <p id="promotionPreviewStatus" class="helper-text"></p>
          <div id="promotionSummary" class="promotion-summary"></div>
          <div id="promotionPreviewGates" class="promotion-preview-list"></div>
          <div id="promotionPreviewBlockers" class="promotion-preview-list"></div>
          <div id="promotionRolloutPlan" class="promotion-preview-list"></div>
        </div>

        <form id="promotionConfirmForm" class="form-grid modal-form">
          <label class="field field-full" for="promotionConfirmInput">
            <span>Type confirmation phrase</span>
            <input id="promotionConfirmInput" autocomplete="off" />
          </label>
          <p id="promotionConfirmHint" class="helper-text field-full"></p>
          <div class="modal-actions field-full">
            <button id="promotionModalCancelBtn" type="button" class="btn btn-subtle">Cancel</button>
            <button id="promotionConfirmBtn" type="submit" class="btn btn-primary" disabled>Confirm move</button>
          </div>
        </form>
      </section>
    </div>

    <div id="rollbackModal" class="modal is-hidden" role="dialog" aria-modal="true" aria-labelledby="rollbackModalTitle">
      <button class="modal-backdrop" data-modal-close="rollback" aria-label="Close rollback dialog"></button>
      <section class="modal-card modal-card-warning" aria-label="Rollback confirmation dialog">
        <header class="modal-header">
          <h2 id="rollbackModalTitle">Review rollback</h2>
          <button id="rollbackModalCloseBtn" type="button" class="btn btn-subtle">Close</button>
        </header>

        <div class="promotion-warning">
          <p class="promotion-warning-title">Preview rollback impact before execution.</p>
          <p id="rollbackPreviewStatus" class="helper-text"></p>
          <div id="rollbackSummary" class="promotion-summary"></div>
          <div id="rollbackCompare" class="promotion-preview-list"></div>
          <div id="rollbackPreviewGates" class="promotion-preview-list"></div>
          <div id="rollbackPreviewBlockers" class="promotion-preview-list"></div>
        </div>

        <form id="rollbackConfirmForm" class="form-grid modal-form">
          <label class="field" for="rollbackScope">
            <span>Rollback scope</span>
            <select id="rollbackScope">
              <option value="code_only">code_only</option>
              <option value="code_and_config">code_and_config</option>
              <option value="full_state">full_state</option>
            </select>
          </label>
          <label class="field" for="rollbackOverride">
            <span>Unsafe override</span>
            <input id="rollbackOverride" type="checkbox" />
          </label>
          <p id="rollbackConfirmHint" class="helper-text field-full"></p>
          <div class="modal-actions field-full">
            <button id="rollbackModalCancelBtn" type="button" class="btn btn-subtle">Cancel</button>
            <button id="rollbackConfirmBtn" type="submit" class="btn btn-danger" disabled>Execute rollback</button>
          </div>
        </form>
      </section>
    </div>

    <div id="toastStack" class="toast-stack" aria-live="polite" aria-atomic="false"></div>

    <script src="/app_core.js"></script>
    <script src="/app_render_projects_ops.js"></script>
    <script src="/app_data_artifacts.js"></script>
    <script src="/app_render_surfaces.js"></script>
    <script src="/app_flow.js"></script>
    <script src="/app_events.js"></script>
    <script src="/app.js"></script>
  </body>
</html>
